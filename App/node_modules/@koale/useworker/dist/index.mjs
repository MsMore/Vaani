import e from"react";import n from"isoworker";import r from"dequal";var t,a=function(e){return function(n){return Promise.resolve(e.fn.apply(e,n.data[0])).then(function(n){var r,t="auto"===e.transferable&&(r=n,"ArrayBuffer"in self&&r instanceof ArrayBuffer||"MessagePort"in self&&r instanceof MessagePort||"ImageBitmap"in self&&r instanceof ImageBitmap||"OffscreenCanvas"in self&&r instanceof OffscreenCanvas)?[n]:[];postMessage(["SUCCESS",n],t)}).catch(function(e){postMessage(["ERROR",e])})}},o=function(e,r,t,o){var i=n.createContext(o)[0],u="\n    "+function(e){return 0===e.length?"":"importScripts('"+e.map(function(e){return""+e}).toString()+"')"}(r)+";\n    "+i+"\n    onmessage=("+a+")({\n      fn: ("+e+"),\n      transferable: '"+t+"'\n    })\n  ",c=new Blob([u],{type:"text/javascript"});return URL.createObjectURL(c)};!function(e){e.PENDING="PENDING",e.SUCCESS="SUCCESS",e.RUNNING="RUNNING",e.ERROR="ERROR",e.TIMEOUT_EXPIRED="TIMEOUT_EXPIRED"}(t||(t={}));var i,u=t;!function(e){e.AUTO="auto",e.NONE="none"}(i||(i={}));var c={timeout:void 0,remoteDependencies:[],autoTerminate:!0,transferable:i.AUTO,localDependencies:function(){return[]}},s=function(n,t){void 0===t&&(t=c);var a,s,l,f=e.useState(u.PENDING),m=f[0],v=f[1],d=e.useRef(),R=e.useRef(!1),p=e.useRef({}),E=e.useRef(),w=e.useCallback(function(e){R.current=e===u.RUNNING,v(e)},[]),C=e.useCallback(function(){var e;(null===(e=d.current)||void 0===e?void 0:e._url)&&(d.current.terminate(),URL.revokeObjectURL(d.current._url),p.current={},d.current=void 0,window.clearTimeout(E.current))},[]),N=e.useCallback(function(e){(null!=t.autoTerminate?t.autoTerminate:c.autoTerminate)&&C(),w(e)},[t.autoTerminate,C,w]),T=(a=function(){var e=t.remoteDependencies,r=t.timeout,a=void 0===r?c.timeout:r,i=t.transferable,s=t.localDependencies,l=o(n,void 0===e?c.remoteDependencies:e,void 0===i?c.transferable:i,void 0===s?c.localDependencies:s),f=new Worker(l);return f._url=l,f.onmessage=function(e){var n,r,t,a,o=e.data,i=o[1];switch(o[0]){case u.SUCCESS:null===(n=(r=p.current).resolve)||void 0===n||n.call(r,i),N(u.SUCCESS);break;default:null===(t=(a=p.current).reject)||void 0===t||t.call(a,i),N(u.ERROR)}},f.onerror=function(e){var n,r;null===(n=(r=p.current).reject)||void 0===n||n.call(r,e),N(u.ERROR)},a&&(E.current=window.setTimeout(function(){C(),w(u.TIMEOUT_EXPIRED)},a)),f},l=e.useRef(s=[n,t,C]),r(l.current,s)||(l.current=s),e.useCallback(a,l.current)),U=e.useCallback(function(){var e=[].slice.call(arguments),n=t,r=n.transferable,a=void 0===r?c.transferable:r;return new Promise(function(n,r){var t,o;p.current=((t={}).resolve=n,t.reject=r,t);var c=a===i.AUTO?e.filter(function(e){return"ArrayBuffer"in window&&e instanceof ArrayBuffer||"MessagePort"in window&&e instanceof MessagePort||"ImageBitmap"in window&&e instanceof ImageBitmap||"OffscreenCanvas"in window&&e instanceof OffscreenCanvas}):[];null===(o=d.current)||void 0===o||o.postMessage([[].concat(e)],c),w(u.RUNNING)})},[w]),b=e.useCallback(function(){var e=null!=t.autoTerminate?t.autoTerminate:c.autoTerminate;return R.current?(console.error("[useWorker] You can only run one instance of the worker at a time, if you want to run more than one in parallel, create another instance with the hook useWorker(). Read more: https://github.com/alewin/useWorker"),Promise.reject()):(!e&&d.current||(d.current=T()),U.apply(void 0,[].slice.call(arguments)))},[t.autoTerminate,T,U]),O={status:m,kill:C};return e.useEffect(function(){return function(){C()}},[C]),[b,O]};export{t as WORKER_STATUS,s as useWorker};
//# sourceMappingURL=index.mjs.map
